<!DOCTYPE HTML>
<html lang="zh-CN" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>é‡Œç¨‹ç¢‘é¡¹ç›® - Tic-Tac-Toe - The Anchor Book v0.23.0 ä¸­æ–‡ç‰ˆ</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../chapter_1/introduction.html"><strong aria-hidden="true">1.</strong> å¼•è¨€</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter_1/what_is_anchor.html"><strong aria-hidden="true">1.1.</strong> ä»€ä¹ˆæ˜¯Anchor</a></li><li class="chapter-item expanded "><a href="../chapter_1/anchor_documentation.html"><strong aria-hidden="true">1.2.</strong> Anchoræ–‡æ¡£</a></li><li class="chapter-item expanded "><a href="../chapter_1/prerequisites.html"><strong aria-hidden="true">1.3.</strong> å¿…è¦åŸºç¡€</a></li></ol></li><li class="chapter-item expanded "><a href="../chapter_2/getting_started.html"><strong aria-hidden="true">2.</strong> å…¥é—¨</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter_2/installation.html"><strong aria-hidden="true">2.1.</strong> å®‰è£…</a></li><li class="chapter-item expanded "><a href="../chapter_2/hello_anchor.html"><strong aria-hidden="true">2.2.</strong> Hello, Anchor!</a></li></ol></li><li class="chapter-item expanded "><a href="../chapter_3/anchor_programs_in-depth.html"><strong aria-hidden="true">3.</strong> æ·±å…¥äº†è§£Anchorç¨‹åº</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter_3/essentials.html"><strong aria-hidden="true">3.1.</strong> æ ¸å¿ƒå†…å®¹</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter_3/high-level_overview.html"><strong aria-hidden="true">3.1.1.</strong> æ€»è§ˆ</a></li><li class="chapter-item expanded "><a href="../chapter_3/the_accounts_struct.html"><strong aria-hidden="true">3.1.2.</strong> The Accounts Struct</a></li><li class="chapter-item expanded "><a href="../chapter_3/the_program_module.html"><strong aria-hidden="true">3.1.3.</strong> The Program Module</a></li><li class="chapter-item expanded "><a href="../chapter_3/errors.html"><strong aria-hidden="true">3.1.4.</strong> Errors</a></li><li class="chapter-item expanded "><a href="../chapter_3/milestone_project_tic-tac-toe.html" class="active"><strong aria-hidden="true">3.1.5.</strong> é‡Œç¨‹ç¢‘é¡¹ç›® - Tic-Tac-Toe</a></li></ol></li><li class="chapter-item expanded "><a href="../chapter_3/intermediate.html"><strong aria-hidden="true">3.2.</strong> è¿›é˜¶å†…å®¹</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter_3/CPIs.html"><strong aria-hidden="true">3.2.1.</strong> è·¨ç¨‹åºè°ƒç”¨Cross-Program Invocations</a></li><li class="chapter-item expanded "><a href="../chapter_3/PDAs.html"><strong aria-hidden="true">3.2.2.</strong> ç¨‹åºå¯¼å‡ºåœ°å€PDAs</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.2.3.</strong> äº‹ä»¶Events</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.2.4.</strong> å¸¸é‡Constants</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.2.5.</strong> é›¶å¤åˆ¶Zero-Copy</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.2.6.</strong> æƒé™æ§åˆ¶Access Control</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.2.7.</strong> æ„å»ºå’Œæµ‹è¯•Building &amp; Testing</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.2.8.</strong> é‡Œç¨‹ç¢‘é¡¹ç›® - The Nightclub</div></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Anchor BTS</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">4.1.</strong> Dispatch</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.</strong> The Discriminator</div></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../chapter_5/anchor_tooling.html"><strong aria-hidden="true">5.</strong> Anchorç›¸å…³å·¥å…·</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter_5/space.html"><strong aria-hidden="true">5.1.</strong> æ•°æ®æ‰€å ç©ºé—´</a></li><li class="chapter-item expanded "><a href="../chapter_5/cli.html"><strong aria-hidden="true">5.2.</strong> å‘½ä»¤è¡ŒCLI</a></li><li class="chapter-item expanded "><a href="../chapter_5/avm.html"><strong aria-hidden="true">5.3.</strong> Anchorç‰ˆæœ¬ç®¡ç†å™¨AVM</a></li><li class="chapter-item expanded "><a href="../chapter_5/anchor-toml_reference.html"><strong aria-hidden="true">5.4.</strong> Anchor.tomlé…ç½®æ–‡ä»¶</a></li></ol></li><li class="chapter-item expanded "><a href="../reference_links.html"><strong aria-hidden="true">6.</strong> å‚è€ƒé“¾æ¥</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Anchor Book v0.23.0 ä¸­æ–‡ç‰ˆ</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="é‡Œç¨‹ç¢‘é¡¹ç›®---tic-tac-toeä¸‰è¿æ£‹æ¸¸æˆ"><a class="header" href="#é‡Œç¨‹ç¢‘é¡¹ç›®---tic-tac-toeä¸‰è¿æ£‹æ¸¸æˆ">é‡Œç¨‹ç¢‘é¡¹ç›® - Tic-Tac-Toeä¸‰è¿æ£‹æ¸¸æˆ</a></h1>
<p>ä½ ç°åœ¨å·²ç»åšå¥½å‡†å¤‡å¼€å‘ä½ çš„ç¬¬ä¸€ä¸ªAnchoré¡¹ç›®äº†ã€‚åˆ›å»ºä¸€ä¸ªæ–°çš„Anchorå·¥ä½œç¯å¢ƒï¼š</p>
<pre><code>anchor init tic-tac-toe
</code></pre>
<p>è¿™ä¸ªç¨‹åºä¼šæœ‰ä¸¤ä¸ªæŒ‡ä»¤(instructions). é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºæ¸¸æˆ(setup)ï¼Œæˆ‘ä»¬éœ€è¦ä¿å­˜è°åœ¨ç©ï¼Œå¹¶ä¸”åˆ›å»ºä¸€ä¸ªå¯ä»¥ç©çš„æ£‹ç›˜ã€‚ç„¶åï¼Œæ¯ä¸ªé€‰æ‰‹è½®æµè¡ŒåŠ¨ï¼Œç›´åˆ°ä¸€æ–¹èƒœå‡ºæˆ–è€…è¾¾åˆ°å¹³å±€ã€‚</p>
<h2 id="åˆ›å»ºæ¸¸æˆsetting-up-the-game"><a class="header" href="#åˆ›å»ºæ¸¸æˆsetting-up-the-game">åˆ›å»ºæ¸¸æˆSetting up the game</a></h2>
<h3 id="çŠ¶æ€state"><a class="header" href="#çŠ¶æ€state">çŠ¶æ€State</a></h3>
<p>æˆ‘ä»¬å…ˆå¼€å§‹æ€è€ƒä¸€ä¸‹æˆ‘ä»¬åº”è¯¥å‚¨å­˜å“ªã€‚æ¯å±€æ¸¸æˆæœ‰ç©å®¶ï¼Œå›åˆï¼Œæ¸¸æˆæ¿ï¼Œè¿˜æœ‰æ¸¸æˆçŠ¶æ€ã€‚è¿™ä¸ªæ¸¸æˆçŠ¶æ€æè¿°æ¸¸æˆæ˜¯ä¸æ˜¯è¿˜åœ¨è¿›è¡Œï¼Œå¹³å±€æˆ–è€…ä¸€æ–¹èµ¢äº†ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰è¿™äº›çŠ¶æ€éƒ½å­˜åœ¨ä¸€ä¸ªaccounté‡Œé¢ã€‚ç€æ„å‘³ç€æ¯æ–°ä¸€å±€æ¸¸æˆéƒ½ä¼šæœ‰è‡ªå·±çš„accountã€‚æŠŠä¸‹é¢è¿™æ®µä»£ç åŠ åˆ°<code>lib.rs</code>çš„æœ€åº•éƒ¨ï¼š</p>
<pre><code class="language-rust ignore">#[account]
pub struct Game {
    players: [Pubkey; 2],          // 64
    turn: u8,                      // 1
    board: [[Option&lt;Sign&gt;; 3]; 3], // 9 * (1 + 1) = 18
    state: GameState,              // 32 + 1
}
</code></pre>
<p>è¿™å°±æ˜¯game account. åœ¨å­—æ®µå®šä¹‰è¾¹ä¸Š, ä½ çœ‹ä¸€çœ‹åˆ°æ¯ä¸ªå­—æ®µè¦æ±‚çš„å­—èŠ‚æ•°. è¿™åœ¨ä¹‹åä¼šç”¨åˆ°. è®©æˆ‘ä»¬æŠŠ<code>Sign</code>å’Œ<code>GameState</code>ç±»å‹ä¹ŸåŠ ä¸Šã€‚</p>
<pre><code class="language-rust ignore">#[derive(AnchorSerialize, AnchorDeserialize, Clone, PartialEq, Eq)]
pub enum GameState {
    Active,
    Tie,
    Won { winner: Pubkey },
}

#[derive(
    AnchorSerialize,
    AnchorDeserialize,
    FromPrimitive,
    ToPrimitive,
    Copy,
    Clone,
    PartialEq,
    Eq
)]
pub enum Sign {
    X,
    O,
}
</code></pre>
<p><code>GameState</code>å’Œ<code>Sign</code>éƒ½é€šè¿‡deriveå¼•å…¥äº†ä¸€äº›traits. å…¶ä¸­<code>AnchorSerialize</code>å’Œ<code>AnchorDeserialize</code>æœ€é‡è¦. æ‰€æœ‰åœ¨è¢«<code>#[account]</code>æ ‡è®°çš„ç±»å‹å†…éƒ¨é¢ä½¿ç”¨çš„ç±»å‹å¿…é¡»å®ç°è¿™ä¸¤ä¸ªtraits(æˆ–è€…æœ¬èº«ä¹Ÿè¢«æ ‡è®°äº†<code>#[account]</code>). æ‰€æœ‰å…¶ä»–çš„traitsä¹Ÿå¯¹æˆ‘ä»¬çš„æ¸¸æˆé€»è¾‘å¾ˆé‡è¦ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¹‹åç”¨åˆ°ã€‚é€šå¸¸ä¸€ä¸ªå¥½çš„ä¹ æƒ¯æ˜¯ä½¿ç”¨æ›´å¤šçš„traitsæ¥è®©ç¨‹åºå¯¹å¤–éƒ¨çš„æ¥å£ç”¨æˆ·æ›´å‹å¥½(å‚è€ƒ <a href="https://rust-lang.github.io/api-guidelines/interoperability.html#types-eagerly-implement-common-traits-c-common-traits">Rustçš„APIæŒ‡å—</a>) ä½†æ˜¯å¤„äºç®€æ´è€ƒè™‘, åœ¨è¿™ä¸ªæŒ‡å—é‡Œæˆ‘ä»¬å°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚</p>
<p>æš‚æ—¶è¿™è¿˜ä¸èƒ½è¿è¡Œï¼Œå› ä¸º<code>FromPrimitive</code>å’Œ<code>ToPrimitive</code>å¯¹ç¨‹åºæ˜¯æœªçŸ¥çš„ã€‚ åœ¨<code>src</code>å¤–é¢çš„<code>Cargo.toml</code>æ–‡ä»¶  (ä¸æ˜¯å·¥ä½œç¯å¢ƒè·Ÿç›®çš„)ç„¶ååŠ ä¸Šè¿™ä¸¤ä¸ªä¾èµ–:</p>
<pre><code class="language-toml">num-traits = &quot;0.2&quot;
num-derive = &quot;0.3&quot;
</code></pre>
<p>æ¥ä¸‹æ¥, åœ¨<code>lib.rs</code>æœ€ä¸Šé¢import:</p>
<pre><code class="language-rust ignore">use num_derive::*;
use num_traits::*;
</code></pre>
<h3 id="setup-instructionå‘½ä»¤"><a class="header" href="#setup-instructionå‘½ä»¤">Setup Instructionå‘½ä»¤</a></h3>
<p>åœ¨æˆ‘ä»¬å®ç°æ¸¸æˆé€»è¾‘ä¹‹å‰, æˆ‘ä»¬å¯ä»¥å…ˆåŠ ä¸Šåœ¨åˆå§‹çŠ¶æ€åˆ›å»ºæ¸¸æˆçš„instructionã€‚æŠŠç°æœ‰çš„instruction functionè¿˜æœ‰accounts structä¸º<code>setup_game</code>å’Œ<code>SetupGame</code>ã€‚ ç°åœ¨æˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸‹åˆ›å»ºæ¸¸æˆéœ€è¦å“ªäº›accountsã€‚æ˜¾ç„¶ï¼Œæˆ‘ä»¬éœ€è¦game accountã€‚åœ¨å¯¹å®ƒè¿›è¡Œå„ç§èµ‹å€¼ä¹‹å‰ï¼Œæˆ‘ä»¬è¦å…ˆåˆ›å»ºå®ƒã€‚å› æ­¤æˆ‘ä»¬è¦ç”¨<code>init</code>é™åˆ¶æ¡ä»¶ã€‚</p>
<pre><code class="language-rust ignore">#[derive(Accounts)]
pub struct SetupGame&lt;'info&gt; {
    #[account(init)]
    pub game: Account&lt;'info, Game&gt;
}
</code></pre>
<p><code>init</code>åº”è¯¥ä¼šç«‹åˆ»æŠ¥é”™å¹¶ä¸”è¦æ·»åŠ ä¸€ä¸ªpayer. ä¸ºä»€ä¹ˆéœ€è¦payerå‘¢? å› ä¸º<code>init</code>ä¼šåˆ›å»ºä¸€ä¸ª<code>å…ç§Ÿ</code>(<code>rent-exempt</code>) accountså› æ­¤å¿…é¡»æœ‰äººè¦ä»˜å‡ºè¶³å¤Ÿçš„è´¹ç”¨. è‡ªç„¶çš„, å¦‚æœæˆ‘ä»¬æƒ³ç”¨æŸäººçš„é’±, æˆ‘ä»¬è‚¯å®šéœ€è¦ä»–ç­¾åï¼Œå¹¶ä¸”æŠŠä»–çš„è´¦å·æ ‡è®°ä¸ºå¯æ›´æ”¹ã€‚</p>
<pre><code class="language-rust ignore">#[derive(Accounts)]
pub struct SetupGame&lt;'info&gt; {
    #[account(init, payer = player_one)]
    pub game: Account&lt;'info, Game&gt;,
    #[account(mut)]
    pub player_one: Signer&lt;'info&gt;
}
</code></pre>
<p><code>init</code>å¯èƒ½è¿˜æ˜¯æœ‰æŠ¥é”™. å®ƒéœ€è¦system programä¹Ÿåœ¨structé‡Œé¢ï¼Œå› ä¸º<code>init</code>åˆ›å»ºgame accountï¼Œéœ€è¦å¯¹system programè°ƒç”¨ã€‚ é‚£æˆ‘ä»¬æŠŠå®ƒä¹ŸåŠ ä¸Šã€‚</p>
<pre><code class="language-rust ignore">#[derive(Accounts)]
pub struct SetupGame&lt;'info&gt; {
    #[account(init, payer = player_one)]
    pub game: Account&lt;'info, Game&gt;,
    #[account(mut)]
    pub player_one: Signer&lt;'info&gt;,
    pub system_program: Program&lt;'info, System&gt;
}
</code></pre>
<p>å®Œæˆ<code>SetupGame</code>è¿˜æœ‰æœ€åä¸€æ­¥ã€‚æ¯ä¸ªaccountéƒ½æ˜¯æŒ‰ç…§å›ºå®šçš„ç©ºé—´å¤§å°åˆ›å»ºçš„ã€‚ <code>init</code>å¯ä»¥ä¼°è®¡ä¸€ä¸ªaccountæ‰€éœ€è¦çš„ç©ºé—´ï¼Œå¦‚æœå®ƒç”±<code>Default</code>å¯¼å‡ºã€‚å› ä¸ºï¼Œè®©æˆ‘ä»¬æ¥ç»™<code>Game</code>å®ç°ä¸€ä¸‹<code>Default</code>ã€‚</p>
<pre><code class="language-rust ignore">#[account]
#[derive(Default)] &lt;-- add this
pub struct Game {...
</code></pre>
<p>and <code>GameState</code>.</p>
<pre><code class="language-rust ignore">impl Default for GameState {
    fn default() -&gt; Self {
        Self::Active
    }
}
</code></pre>
<p>è¿™æ ·, <code>SetupGame</code>å°±å®Œæˆäº†ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­<code>setup_game</code> functionçš„å¼€å‘ã€‚(å¦‚æœä½ æƒ³åšä¾¦æ¢ï¼Œä½ å¯ä»¥è¯•ç€æ£€æŸ¥ï¼Œä¸ºä»€ä¹ˆç›®å‰è¿™ä¸ªå®ç°ä¾ç„¶æœ‰é—®é¢˜ã€‚ æç¤º: æŸ¥çœ‹<a href="https://borsh.io/">borsh æ–‡æ¡£</a>ï¼Œä¹Ÿå°±æ˜¯Anchorç”¨çš„åºåˆ—åŒ–åº“ã€‚å¦‚æœä½ çœ‹ä¸å‡ºæ¥é—®é¢˜ï¼Œä¹Ÿæ²¡å…³ç³»ã€‚ æˆ‘ä»¬å¾ˆå¿«å°±ä¼šä»‹ç»å®ƒ)</p>
<p>è®©æˆ‘ä»¬å…ˆç»™<code>setup_game</code>functionåŠ ä¸ªå‚æ•°.</p>
<pre><code class="language-rust ignore">pub fn setup_game(ctx: Context&lt;SetupGame&gt;, player_two: Pubkey) -&gt; ProgramResult {
    Ok(())
}
</code></pre>
<p>ä¸ºä»€ä¹ˆä¸ç›´æ¥æŠŠ<code>player_two</code>ä½œä¸ºaccountåŠ åˆ°accounts structé‡Œé¢å‘¢ï¼Ÿæœ‰ä¸¤ä¸ªåŸå› ï¼Œé¦–å…ˆï¼ŒåŠ åˆ°accountsé‡Œé¢ä¼šè®©äº¤æ˜“å ç”¨æ›´å¤šçš„ç©ºé—´å› ä¸ºéœ€è¦è®°å½•accountæ˜¯ä¸æ˜¯å¯å†™å…¥(writable)å’Œæ˜¯ä¸æ˜¯ç­¾åè€…(signer)ã€‚ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸éœ€è¦è¿™ä¸¤ä¸ªçŠ¶æ€ï¼Œåªéœ€è¦åœ°å€addressã€‚ç¬¬äºŒä¸ªä¹Ÿæ˜¯æ›´é‡è¦ä¸€ä¸ªåŸå› ï¼Œå¦‚æœç”¨åˆ°äº†åŒä¸€ä¸ªè´¦å·ï¼Œä¸€ä¸ªäº¤æ˜“å¯ä»¥å½±å“åˆ°ç½‘ç»œä¸­åŒæ—¶åœ¨å¤„ç†çš„å…¶ä»–äº¤æ˜“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ<code>player_two</code>åŠ åˆ°äº†accounts struct, é‚£å†å¤„ç†æˆ‘ä»¬çš„äº¤æ˜“çš„æ—¶å€™ï¼Œä»»ä½•å…¶ä»–äº¤æ˜“éƒ½ä¸å¯ä»¥ç¼–è¾‘<code>player_two</code>çš„accountã€‚ ä¹Ÿå°±æ˜¯è¯´, æˆ‘ä»¬é˜»å¡äº†æ‰€æœ‰å…¶ä»–çš„æƒ³ç¼–è¾‘<code>player_two</code>çš„accountçš„äº¤æ˜“, å³ä½¿æˆ‘ä»¬æ ¹æœ¬ä¸æƒ³åŠ¨è¿™ä¸ªaccount. æˆ‘ä»¬åªåœ¨ä¹å®ƒçš„åœ°å€ï¼</p>
<p>å®Œæˆinstruction functionï¼Œè®¾ç½®gameçš„åˆå§‹å€¼:</p>
<pre><code class="language-rust ignore">pub fn setup_game(ctx: Context&lt;SetupGame&gt;, player_two: Pubkey) -&gt; ProgramResult {
    let game = &amp;mut ctx.accounts.game;
    game.players = [ctx.accounts.player_one.key(), player_two];
    game.turn = 1;
    Ok(())
}
</code></pre>
<p>ç°åœ¨ï¼Œè¿è¡Œ<code>anchor build</code>ã€‚é™¤äº†ç¼–è¯‘ä½ çš„ç¨‹åºï¼Œè¿™ä¸ªå‘½ä»¤è¿˜ä¼šä¸ºä½ çš„ç¨‹åºåˆ›å»ºä¸€ä¸ª<a href="https://en.wikipedia.org/wiki/Interface_description_language">IDL</a>ã€‚ å…·ä½“ä½ç½®åœ¨<code>target/idl</code>. Anchorçš„typescriptå®¢æˆ·ç«¯å¯ä»¥è‡ªåŠ¨è§£æIDLï¼Œå¹¶æ ¹æ®å®ƒç”Ÿæˆå‡½æ•°. è¿™æ„å‘³ç€æ¯ä¸ªAnchorç¨‹åºéƒ½æœ‰å…è´¹çš„Typescriptå®¢æˆ·ç«¯(è‡ªåŠ¨ç”Ÿæˆ)! (ç†è®ºä¸Šè¯´, æµ‹è¯•ä¹‹å‰ä½ ä¸éœ€è¦è°ƒç”¨anchor build. <code>anchor test</code>ä¼šå¸®ä½ è°ƒç”¨.)</p>
<h3 id="æµ‹è¯•setup-instruction"><a class="header" href="#æµ‹è¯•setup-instruction">æµ‹è¯•Setup Instruction</a></h3>
<p>è¯¥æµ‹è¯•ä»£ç äº†! å»é¡¹ç›®æ ¹ç›®å½•çš„<code>tests</code>æ–‡ä»¶å¤¹. æ‰“å¼€<code>tic-tac-toe.ts</code>æ–‡ä»¶ç„¶ååˆ æ‰<code>it</code>test. ç„¶å, æŠŠä¸‹é¢çš„å¸¦å§æ·»åŠ åˆ°<code>describe</code>éƒ¨åˆ†:</p>
<pre><code class="language-typescript">  it('setup game!', async() =&gt; {
    const gameKeypair = anchor.web3.Keypair.generate();
    const playerOne = program.provider.wallet;
    const playerTwo = anchor.web3.Keypair.generate();
    await program.rpc.setupGame(playerTwo.publicKey, {
      accounts: {
        game: gameKeypair.publicKey,
        playerOne: playerOne.publicKey,
        systemProgram: anchor.web3.SystemProgram.programId
      },
      signers: [gameKeypair]
    });

    let gameState = await program.account.game.fetch(gameKeypair.publicKey);
    expect(gameState.turn).to.equal(1);
    expect(gameState.players)
      .to
      .eql([playerOne.publicKey, playerTwo.publicKey]);
    expect(gameState.state).to.eql({ active: {} });
    expect(gameState.board)
      .to
      .eql([[null,null,null],[null,null,null],[null,null,null]]);
  });
</code></pre>
<p>ç„¶åæŠŠè¿™ä¸ªåŠ åˆ°æ–‡ä»¶å¼€å¤´:</p>
<pre><code class="language-typescript">import { expect } from 'chai';
</code></pre>
<p>æµ‹è¯•å¼€å§‹æˆ‘ä»¬å…ˆåˆ›å»ºä¸€äº›å…¬ç§é’¥å¯¹ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯, <code>playerOne</code>å¹¶ä¸æ˜¯å…¬ç§é’¥å¯¹ï¼Œè€Œæ˜¯ç¨‹åºproviderçš„é’±åŒ…. Providerçš„ç»†èŠ‚æ˜¯åœ¨é¡¹ç›®æ ¹ç›®å½•çš„<code>Anchor.toml</code>æ–‡ä»¶ä¸­å®šä¹‰çš„ã€‚
ç„¶å, æˆ‘ä»¬å‘é€äº¤æ˜“ã€‚å› ä¸ºanchorçš„typescriptå®¢æˆ·ç«¯è§£æäº†IDL,æ‰€æœ‰äº¤æ˜“çš„è¾“å…¥éƒ½æœ‰ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å°‘åŠ äº†ä¸€ä¸ªaccount,typescriptå°±ä¼šæŠ¥é”™ã€‚ 
æ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»transaction functionçš„ç»“æ„. ç¬¬ä¸€æ˜¯instructionçš„å‚æ•°ã€‚ å°±è¿™ä¸ªfunctionæ¥è¯´, æ˜¯second playerçš„å…¬é’¥ã€‚æ¥ä¸‹æ¥æ˜¯accounts. æœ€å, æˆ‘ä»¬åŠ ä¸Šsignersæ•°ç»„ã€‚ è¿™é‡Œæˆ‘ä»¬å¿…é¡»åŠ ä¸Š<code>gameKeypair</code>ä¹Ÿå°±æ˜¯gameçš„å…¬ç§é’¥å¯¹ï¼Œå› ä¸ºæ¯å½“ä¸€ä¸ªaccountè¢«åˆ›å»º, å®ƒéƒ½è¦å¯¹åˆ›å»ºè´¦å·çš„transactionç­¾åã€‚ æˆ‘ä»¬ä¸éœ€è¦åŠ <code>playerOne</code>ï¼Œå°½ç®¡å®ƒåœ¨ç¨‹åºä¸­å®šä¹‰çš„æ˜¯<code>Signer</code>ç±»å‹ï¼Œå› ä¸ºå®ƒæ˜¯ç¨‹åºçš„providerå¹¶ä¸”æœ¬èº«å°±ä¼šå¯¹transactionç­¾åã€‚</p>
<p>åœ¨transactionè¿”å›ç»“æœåï¼Œæˆ‘ä»¬å¯ä»¥è¯»å–game accountçš„çŠ¶æ€ã€‚é€šå¸¸ä½ å¯ä»¥é€šè¿‡<code>program.account</code> namespaceæ¥è¯»å–accountçš„çŠ¶æ€ã€‚ 
æœ€åï¼Œæˆ‘ä»¬æ¥éªŒè¯gameå·²ç»è¢«æˆåŠŸçš„åˆ›å»ºäº†ã€‚Anchorçš„typescriptå®¢æˆ·ç«¯ä¼šè¿™æ ·ååºåˆ—åŒ–rustçš„enum: <code>{ active: {}}</code>å¯¹åº”ä¸€ä¸ªæ²¡æœ‰å­—æ®µçš„å˜å‹ï¼Œè€Œ<code>{ won: { winner: Pubkey }}</code> å¯¹åº”æœ‰å­—æ®µå€¼çš„å˜å‹. <code>Option</code>çš„<code>None</code>å˜å‹ä¼šè¢«è½¬åŒ–ä¸º<code>null</code>.<code>Some(x)</code>ä¼šè¢«è½¬åŒ–ä¸º<code>x</code>ååºåˆ—åŒ–çš„ç»“æœ.</p>
<p>ç°åœ¨è¿è¡Œ<code>anchor test</code>ã€‚è¿™ä¼šå¯åŠ¨(ä¹‹åè‡ªåŠ¨å…³é—­)ä¸€ä¸ªæœ¬åœ°çš„validator(ç¡®è®¤åœ¨ç€ä¹‹å‰ä½ è‡ªå·±æ²¡æœ‰è¿è¡Œvalidator)ç„¶åè¿è¡Œä½ å®šä¹‰åœ¨<code>Anchor.toml</code>ä¸­çš„æµ‹è¯•è„šæœ¬ã€‚</p>
<h2 id="å®ç°æ¸¸æˆplaying-the-game"><a class="header" href="#å®ç°æ¸¸æˆplaying-the-game">å®ç°æ¸¸æˆPlaying the game</a></h2>
<h3 id="the-play-instruction"><a class="header" href="#the-play-instruction">The Play Instruction</a></h3>
<p><code>Play</code> accounts structå¾ˆå®¹æ˜“æ‡‚. æˆ‘ä»¬éœ€è¦ä¸€ä¸ªgame accountè¿˜æœ‰ä¸€ä¸ªç©å®¶player:</p>
<pre><code class="language-rust ignore">#[derive(Accounts)]
pub struct Play&lt;'info&gt; {
    #[account(mut)]
    pub game: Account&lt;'info, Game&gt;,
    pub player: Signer&lt;'info&gt;,
}
</code></pre>
<p><code>player</code>éœ€è¦ç­¾åå¦åˆ™ï¼Œå…¶ä»–äººä¹Ÿå¯ä»¥æ¥å†’åé¡¶æ›¿.</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®ç°æ¸¸æˆé€»è¾‘:</p>
<pre><code class="language-rust ignore">impl Game {
    pub fn is_active(&amp;self) -&gt; bool {
        self.state == GameState::Active
    }

    fn current_player_index(&amp;self) -&gt; usize {
        ((self.turn - 1) % 2) as usize
    }

    pub fn current_player(&amp;self) -&gt; Pubkey {
        self.players[self.current_player_index()]
    }

    pub fn play(&amp;mut self, tile: &amp;Tile) -&gt; ProgramResult {
        if !self.is_active() {
            return Err(TicTacToeError::GameAlreadyOver.into());
        }
        match tile {
            tile
            @ Tile {
                row: 0..=2,
                column: 0..=2,
            } =&gt; match self.board[tile.row as usize][tile.column as usize] {
                Some(_) =&gt; return Err(TicTacToeError::TileAlreadySet.into()),
                None =&gt; {
                    self.board[tile.row as usize][tile.column as usize] =
                        Some(Sign::from_usize(self.current_player_index()).unwrap());
                }
            },
            _ =&gt; return Err(TicTacToeError::TileOutOfBounds.into()),
        }

        self.update_state();

        if let GameState::Active = self.state {
            self.turn += 1;
        }

        Ok(())
    }

    fn is_winning_trio(&amp;self, trio: [(usize, usize); 3]) -&gt; bool {
        let [first, second, third] = trio;
        self.board[first.0][first.1].is_some()
            &amp;&amp; self.board[first.0][first.1] == self.board[second.0][second.1]
            &amp;&amp; self.board[first.0][first.1] == self.board[third.0][third.1]
    }

    fn update_state(&amp;mut self) {
        for i in 0..=2 {
            // three of the same in one row
            if self.is_winning_trio([(i, 0), (i, 1), (i, 2)]) {
                self.state = GameState::Won {
                    winner: self.current_player(),
                };
                return;
            }
            // three of the same in one column
            if self.is_winning_trio([(0, i), (1, i), (2, i)]) {
                self.state = GameState::Won {
                    winner: self.current_player(),
                };
                return;
            }
        }

        // three of the same in one diagonal
        if self.is_winning_trio([(0, 0), (1, 1), (2, 2)])
            || self.is_winning_trio([(0, 2), (1, 1), (2, 0)])
        {
            self.state = GameState::Won {
                winner: self.current_player(),
            };
            return;
        }

        // reaching this code means the game has not been won,
        // so if there are unfilled tiles left, it's still active
        for row in 0..=2 {
            for column in 0..=2 {
                if self.board[row][column].is_none() {
                    return;
                }
            }
        }

        // game has not been won
        // game has no more free tiles
        // -&gt; game ends in a tie
        self.state = GameState::Tie;
    }
}
</code></pre>
<p>è¿™æ®µä»£ç æˆ‘ä»¬å°±ä¸ä¸€èµ·ç»†çœ‹äº†ï¼Œå› ä¸ºæ˜¯æ¯”è¾ƒç®€å•çš„rustä»£ç ã€‚æ¯•ç«Ÿä¸‰è¿æ£‹æœ¬èº«å°±æ˜¯ä¸ªç®€å•çš„æ¸¸æˆï¼å¤§è‡´ä¸Šï¼Œæ¯å½“<code>play</code>è¢«è°ƒç”¨ï¼Œä¼šæœ‰è¿™äº›åŠ¨ä½œ:</p>
<ol>
<li>return error if æ¸¸æˆç»“æŸ or
return error if è¾“å…¥çš„è¡Œæˆ–è€…åˆ—çš„ä½ç½®åœ¨3x3 boardå¤–é¢ or
return error if tile on æ¿å­ä¸Šçš„ä½ç½®å·²ç»è¢«å¡«è¿‡äº†</li>
<li>ç¡®å®šç°åœ¨çš„player å¹¶ä¸”æŠŠè½æ£‹å­çš„ä½ç½®è®¾ä¸º X æˆ– O</li>
<li>æ›´æ–° game state</li>
<li>if game è¿˜æ˜¯ activeçŠ¶æ€, å¢åŠ  the turnå›åˆæ•°</li>
</ol>
<p>ç›®å‰, ä»£ç è¿˜æ˜¯æ— æ³•ç¼–è¯‘ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å®ç°<code>Tile</code>ç±»å‹</p>
<pre><code class="language-rust ignore">#[derive(AnchorSerialize, AnchorDeserialize)]
pub struct Tile {
    row: u8,
    column: u8,
}
</code></pre>
<p>and the <code>TicTacToeError</code> type.</p>
<pre><code class="language-rust ignore">#[error]
pub enum TicTacToeError {
    TileOutOfBounds,
    TileAlreadySet,
    GameAlreadyOver,
    NotPlayersTurn,
}
</code></pre>
<p>æœ€å, æˆ‘ä»¬æŠŠ <code>play</code> functionæ·»åŠ åˆ°programæ¨¡å—ã€‚</p>
<pre><code class="language-rust ignore">pub fn play(ctx: Context&lt;Play&gt;, tile: Tile) -&gt; ProgramResult {
    let game = &amp;mut ctx.accounts.game;

    require!(
        game.current_player() == ctx.accounts.player.key(),
        TicTacToeError::NotPlayersTurn
    );

    game.play(&amp;tile)
}
</code></pre>
<p>åœ¨accounts structä¸­æˆ‘ä»¬å·²ç»æ£€æŸ¥è¿‡<code>player</code> accountå·²ç»å¯¹transactionç­¾åï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰æ£€æŸ¥è¿™ä¸ª<code>player</code>æ˜¯ä¸æ˜¯æˆ‘ä»¬é¢„æœŸgameä¸­æ‰€å¯¹åº”çš„<code>player</code>ã€‚è¿™å°±æ˜¯<code>play</code>é‡Œé¢<code>require</code>çš„ä½œç”¨ã€‚</p>
<h3 id="testing-the-play-instruction"><a class="header" href="#testing-the-play-instruction">Testing the Play Instruction</a></h3>
<p>æµ‹è¯•<code>play</code> instructionçš„æ–¹æ³•å’Œä¹‹å‰ç±»ä¼¼ã€‚ ä¸ºäº†ä¸å†™é‡å¤ä»£ç , æˆ‘ä»¬å¯ä»¥åœ¨æµ‹è¯•æ–‡ä»¶çš„æœ€ä¸Šé¢åˆ›å»ºä¸€ä¸ªhelper function:</p>
<pre><code class="language-typescript">async function play(program, game, player,
    tile, expectedTurn, expectedGameState, expectedBoard) {
  await program.rpc.play(tile, {
    accounts: {
      player: player.publicKey,
      game
    },
    signers: player instanceof (anchor.Wallet as any) ? [] : [player]
  });

  const gameState = await program.account.game.fetch(game);
  expect(gameState.turn).to.equal(expectedTurn);
  expect(gameState.state).to.eql(expectedGameState);
  expect(gameState.board)
    .to
    .eql(expectedBoard);
}
</code></pre>
<p>ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„<code>it</code>æµ‹è¯•, åƒä¸Šä¸ªæµ‹è¯•é‡Œé¢é‚£æ ·åˆ›å»ºgame, ç„¶åè¿ç»­è°ƒç”¨æˆ‘ä»¬åˆšåŠ çš„<code>play</code> functionæ¥æ¨¡æ‹Ÿç©ä¸€æ•´å±€æ¸¸æˆã€‚ Let's begin with the first turn:</p>
<pre><code class="language-typescript">it('player one wins', async() =&gt; {
    const gameKeypair = anchor.web3.Keypair.generate();
    const playerOne = program.provider.wallet;
    const playerTwo = anchor.web3.Keypair.generate();
    await program.rpc.setupGame(playerTwo.publicKey, {
      accounts: {
        game: gameKeypair.publicKey,
        playerOne: playerOne.publicKey,
        systemProgram: anchor.web3.SystemProgram.programId
      },
      signers: [gameKeypair]
    });

    let gameState = await program.account.game.fetch(gameKeypair.publicKey);
    expect(gameState.turn).to.equal(1);
    expect(gameState.players)
      .to
      .eql([playerOne.publicKey, playerTwo.publicKey]);
    expect(gameState.state).to.eql({ active: {} });
    expect(gameState.board)
      .to
      .eql([[null,null,null],[null,null,null],[null,null,null]]);

    await play(
      program,
      gameKeypair.publicKey,
      playerOne,
      {row: 0, column: 0},
      2,
      { active: {}, },
      [
        [{x:{}},null,null],
        [null,null,null],
        [null,null,null]
      ]
    );
});
</code></pre>
<p>ç„¶åå†æ¬¡è¿è¡Œ<code>anchor test</code>ï¼Œä½†ä½ ä¼šå‘ç°ä¸€ä¸ªæŠ¥é”™:</p>
<pre><code>Error: 3004: Failed to serialize the account
</code></pre>
<p>è¿™å’‹åŠ? æˆ‘ä»¬çŸ¥é“è¿™è‚¯å®šæ˜¯è¿è¡Œplayæ—¶å€™çš„é—®é¢˜, å› ä¸º<code>setupGame</code>çš„æµ‹è¯•è¿è¡ŒæˆåŠŸã€‚
å¦å¤–, æŠ¥é”™è¯´<code>serialize</code>(åºåˆ—åŒ–), ä¸æ˜¯<code>deserialize</code>(ååºåˆ—åŒ–). æ‰€ä»¥æˆ‘ä»¬çš„ä»£ç è¿è¡Œäº†ï¼Œç„¶åanchorè¯•å›¾ä¿å­˜æ•°æ®ï¼Œä½†å‡ºé”™äº†ã€‚
è¿™ç±»æŠ¥é”™é€šå¸¸æ„å‘³ç€æˆ‘ä»¬çš„accountå¤ªå°äº†ï¼Œæ— æ³•ä¿å­˜æ‰€æœ‰çš„æ•°æ®ï¼Œè€Œåœ¨è¿™é‡Œæ°æ°å°±æ˜¯è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬å†ç»†çœ‹ä¸€ä¸‹<code>Game</code> structè¿˜æœ‰æˆ‘ä»¬åˆ›å»ºå®ƒçš„æ–¹æ³•:</p>
<pre><code class="language-rust ignore">#[account]
#[derive(Default)]
pub struct Game {
    players: [Pubkey; 2],          // 64
    turn: u8,                      // 1
    board: [[Option&lt;Sign&gt;; 3]; 3], // 9 * (1 + 1) = 18
    state: GameState,              // 32 + 1
}

...
#[account(init, payer = player_one)]
pub game: Account&lt;'info, Game&gt;,
...

</code></pre>
<p>å›å¿†æˆ‘ä»¬ä½¿ç”¨<code>Default</code>æ ‡è®°<code>Game</code>ï¼Œå› ä¸º<code>init</code>ä¼šæ ¹æ®<code>Default</code>è¯•å›¾æ¨åˆ°æ‰€éœ€è¦çš„æ­£ç¡®çš„ç©ºé—´å¤§å°, â€œè¯•å›¾â€æ˜¯å…³é”®è¯. å†æˆ‘ä»¬ä¸æ˜ç¡®å®šä¹‰accountæ‰€éœ€è¦çš„ç©ºé—´(<code>space</code> requirement)ï¼ŒAnchorä¼šè°ƒç”¨accountçš„<code>default</code>ï¼Œç„¶åæŠŠå®ƒç”¨borshåºåˆ—åº“è½¬åŒ–ä¸ºä¸€ä¸ªvectorç±»å‹. ç„¶åAnchorä¼šç”¨è¿™ä¸ªvectorçš„é•¿åº¦ä½œä¸ºaccountæ‰€éœ€è¦çš„ç©ºé—´å¤§å°ã€‚
é‚£æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çš„ç”¨<a href="https://borsh.io/">borshçš„æ–‡æ¡£</a>æ¥è¿‡ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç . æ—è¾¹çš„æ³¨é‡Šå‘Šè¯‰æˆ‘ä»¬å¿…é¡»çš„ç©ºé—´å¤§å°è¦æ±‚, ä¹Ÿå°±æ˜¯ï¼Œå¯¹åº”ç±»å‹çš„æœ€å¤§æ‰€å ç©ºé—´ã€‚</p>
<ul>
<li>Pubkey as a vector has a length of <code>32</code> so <code>2*32 = 64</code> âœ…</li>
<li>u8 as a vector has a length of <code>1</code> so <code>1 = 1</code> âœ…</li>
<li>board's default (<code>9 * None</code>) as a vector has a length of <code>9 != 18</code> âŒ</li>
<li>state's default as a vector is <code>1 != 33</code> âŒ</li>
</ul>
<p>ç»“è®ºæ˜¯<code>init</code>ç›®å‰æ˜¯é¢„ç•™äº†75å­—èŠ‚ç»™æˆ‘ä»¬çš„accountä½†accountå¯èƒ½éœ€è¦(64 + 1 + 18 + 33) = 116å­—èŠ‚ã€‚
æˆ‘ä»¬å¯ä»¥è¿™æ ·æŠŠè¿™ä¸ªæ•°å­—åŠ åˆ°æˆ‘ä»¬çš„å®ç°é‡Œé¢:</p>
<pre><code class="language-rust ignore">impl Game {
    const MAXIMUM_SIZE: usize = 116;

    ... // other functions
}
</code></pre>
<pre><code class="language-rust ignore">...
#[account(init, payer = player_one, space = Game::MAXIMUM_SIZE + 8)]
pub game: Account&lt;'info, Game&gt;,
...
</code></pre>
<p>å†gameçŠ¶æ€çš„åŸºç¡€ä¸Š, æˆ‘ä»¬è¿˜è¦é¢å¤–åŠ ä¸Š<code>8</code>å­—èŠ‚ä½œä¸ºspace. è¿™ä¸ªé¢å¤–çš„ç©ºé—´æ˜¯ç•™ç‚¹ç»™Anchorè‡ªåŠ¨è®¾ç½®çš„<code>discriminator</code>çš„ã€‚ ç®€çŸ­è¯´,discriminatoræ˜¯Anchorç”¨æ¥åŒºåˆ†åŒä¸€ä¸ªç¨‹åºä¸­ä¸åŒaccountçš„æ ‡è¯†ã€‚</p>
<blockquote>
<p>(é‚£ç”¨<code>mem::size_of&lt;Game&gt;()</code>? è¿™ä¸ªæ–¹æ³•å‡ ä¹å¯ä»¥ï¼Œä½†è¿˜æ˜¯ä¸è¡Œã€‚ é—®é¢˜æ˜¯borshåº“æ€»æ˜¯æŠŠoptionçš„æ ‡è¯†åºåˆ—åŒ–ä¸º1å­—èŠ‚ç„¶åé¢å¤–çš„xå­—èŠ‚å¦‚æœå€¼æ˜¯<code>Some</code>. Ruståœ¨å¯ä»¥çš„æ—¶å€™ä¼šç”¨null-pointerä¼˜åŒ–æ¥è®©Optionçš„æ ‡è¯†å é›¶å­—èŠ‚, æ‰€æœ‰æœ‰çš„æ—¶å€™optionå’Œå®ƒçš„å†…å®¹ä¸€æ ·å¤§ã€‚<code>Sign</code>å°±æ˜¯è¢«è¿™æ ·å¤„ç†çš„ã€‚ è¿™æ„å‘³ç€<code>MAXIMUM_SIZE</code>å¯èƒ½ä¼šè¢«è¡¨ç¤ºä¸º<code>mem::size_of&lt;Game&gt;() + 9</code>ï¼Œè¿™è¿˜æ˜¯ä¸å¯¹çš„)</p>
</blockquote>
<p>å†è¿è¡Œ<code>anchor test</code>åº”è¯¥å°±å¯ä»¥æˆåŠŸäº†ã€‚ ä½ å¯ä»¥è‡ªå·±å®Œæˆä½™ä¸‹çš„æµ‹è¯•äº†ã€‚è¯•ç€æ¨¡æ‹Ÿä¸€ä¸ªå¹³å±€å’Œèµ¢çš„å±€!</p>
<p>å®Œå–„çš„æµ‹è¯•è¿˜åº”è¯¥åŒ…æ‹¬è¯•å›¾æ”»å‡»åˆçº¦çš„æµ‹è¯•ã€‚ä½ å¯ä»¥æ£€æŸ¥ä½ æ—¶å€™å¦¥å–„çš„è€ƒè™‘åˆ°äº†ç”¨éå¸¸è§„å‚æ•°æ¶æ„è°ƒç”¨ä½ <code>play</code>çš„æƒ…å†µã€‚ æ¯”å¦‚:</p>
<pre><code class="language-typescript">try {
  await play(
    program,
    gameKeypair.publicKey,
    playerTwo,
    {row: 5, column: 1}, // out of bounds row
    4,
    { active: {}, },
    [
      [{x:{}},{x: {}},null],
      [{o:{}},null,null],
      [null,null,null]
    ]
  );
  // we use this to make sure we definitely throw an error
  chai.assert(false, &quot;should've failed but didn't &quot;);
} catch (error) {
  expect(error.code).to.equal(6000);
}
</code></pre>
<h2 id="éƒ¨ç½²"><a class="header" href="#éƒ¨ç½²">éƒ¨ç½²</a></h2>
<p>Solanaæœ‰ä¸‰ä¸ªç½‘è·¯: ä¸»ç½‘<code>mainnet-beta</code>, å¼€å‘ç½‘<code>devnet</code>, å’Œæµ‹è¯•ç½‘<code>testnet</code>.
å¯¹å¼€å‘è€…æ¥è¯´, <code>devnet</code>å’Œ<code>mainnet-beta</code>æœ€å€¼å¾—å…³æ³¨ã€‚ <code>devnet</code>æ˜¯ä½ æœ€æ¥è¿‘çœŸå®çš„æµ‹è¯•ç¯å¢ƒï¼Œç›¸æ¯”æœ¬åœ°ç¯å¢ƒ<code>localnet</code>ã€‚ <code>testnet</code>é€šå¸¸åªå’ŒValidatorsç›¸å…³ã€‚</p>
<p>æˆ‘ä»¬å°†åœ¨<code>devnet</code>éƒ¨ç½².</p>
<p>è¿™é‡Œæ˜¯ä½ çš„éƒ¨ç½²æ£€æŸ¥æ¸…å• ğŸš€</p>
<ol>
<li>è¿è¡Œ <code>anchor build</code>. ä½ çš„program keypairä¼šä¿å­˜äº<code>target/deploy</code>. è®°å¾—è¿™ä¸ªéœ€è¦ä¿å¯†. ä½ å¯ä»¥åœ¨å…¶ä»–çš„ç½‘ç»œä½¿ç”¨.</li>
<li>è¿è¡Œ <code>solana address -k target/deploy/tic_tac_toe-keypair.json</code>ç„¶åå¤åˆ¶åœ°å€åˆ°<code>lib.rs</code>é¡¶éƒ¨çš„<code>declare_id!</code>å®.</li>
<li>è¿è¡Œ <code>anchor build</code> å¤šä¸€æ¬¡. è¿™æ­¥å¾ˆå¿…è¦ï¼Œå› ä¸ºéœ€è¦ä¿è¯æ–°çš„program idå­˜å…¥äºŒè¿›åˆ¶é‡Œé¢ã€‚</li>
<li>æ›´æ”¹<code>Anchor.toml</code>ä¸­çš„<code>provider.cluster</code>å˜é‡ä¸º<code>devnet</code>.</li>
<li>è¿è¡Œ <code>anchor deploy</code></li>
<li>è¿è¡Œ <code>anchor test</code></li>
</ol>
<p>æœ‰å…³éƒ¨ç½²çš„å†…å®¹è¿˜æœ‰å¾ˆå¤šã€‚ä¾‹å¦‚ï¼Œç†è§£BPFLoaderçš„å·¥ä½œåŸç†,å¦‚ä½•ç®¡ç†keys, è¿˜æœ‰å¦‚ä½•å‡çº§ä½ çš„ç¨‹åºç­‰ç­‰. ç»§ç»­è¯»æ›´å¤šæ–‡æ¡£æ¥å­¦ä¹ æŠŠ!</p>
<p>å¹²å¾—æ¼‚äº®! ä½ å®Œæˆäº†æ ¸å¿ƒå†…å®¹. ç°åœ¨å¯ä»¥å»å­¦ä¹ æ›´é«˜çº§çš„Anchorå†…å®¹äº†ã€‚</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../chapter_3/errors.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../chapter_3/intermediate.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../chapter_3/errors.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../chapter_3/intermediate.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
